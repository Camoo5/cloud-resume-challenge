
name: Manual trigger
  #Deploys when push is made from the frontend folder

on:
  workflow_dispatch:
  push:
        branches: [ main ]
        paths:
            - "frontend/**"
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
     - uses: actions/checkout@v3
     - name: login with azure
       uses: azure/login@v2
     - name:  Run AZ CLI script
       uses:  azure/CLI@v1  
       with:
         creds: ${{ secrets.AZURE_CREDENTIALS }}

     - name: Upload to blob storage
       uses: azure/CLI@v2
       with:
        azcliversion: latest
        inlineScript: |
            az storage blob upload-batch --account-name azureresumewo--auth-mode key -d '$web' -s frontend/
     - name: Purge CDN endpoint
       uses: azure/CLI@v1
       with:
        azcliversion: latest
        inlineScript: |
          az cdn endpoint purge --content-paths  "/*" --profile-name "azureresumeoo" --name "azureresumeoo" --resource-group "AzureResume-rg"

     # Azure logout
     - name: logout
       run: |
        az logout
    if: always()